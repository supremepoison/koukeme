<view class="container">
  <view class="bg-pattern"></view>

  <view class="tip-card">
    <text class="tip-icon">ğŸ’¡</text>
    <text class="tip-text">{{currentTip}}</text>
  </view>

  <view class="header">
    <view class="sobriety-time">
      <text class="time-label">å·²æ¸…é†’</text>
      <view class="time-display">
        <view class="time-unit">
          <text class="time-value">{{sobrietyTime.days}}</text>
          <text class="time-unit-text">å¤©</text>
        </view>
        <text class="time-separator">:</text>
        <view class="time-unit">
          <text class="time-value">{{sobrietyTime.hours}}</text>
          <text class="time-unit-text">æ—¶</text>
        </view>
        <text class="time-separator">:</text>
        <view class="time-unit">
          <text class="time-value">{{sobrietyTime.minutes}}</text>
          <text class="time-unit-text">åˆ†</text>
        </view>
        <text class="time-separator">:</text>
        <view class="time-unit">
          <text class="time-value">{{sobrietyTime.seconds}}</text>
          <text class="time-unit-text">ç§’</text>
        </view>
      </view>
    </view>
  </view>

  <view class="stats-section">
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-icon">ğŸ’°</text>
        <text class="stat-value">Â¥{{savedMoney}}</text>
        <text class="stat-label">çœä¸‹çš„é’±</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">ğŸ”¥</text>
        <text class="stat-value">{{savedCalories}}K</text>
        <text class="stat-label">å‡å°‘å¡è·¯é‡Œ</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">â­</text>
        <text class="stat-value">12</text>
        <text class="stat-label">è·å¾—æˆå°±</text>
      </view>
      <navigator url="/pages/simulation-lab/simulation-lab" class="stat-item stat-item-thirsty">
        <text class="stat-icon">ğŸ§ª</text>
        <text class="stat-value">èµ›åšå–é…’</text>
      </navigator>
    </view>
  </view>

  <view class="body-status-section">
    <view class="status-header">èº«ä½“çŠ¶æ€</view>
    <view class="status-image-container" bindtap="showStatusDetail">
      <image class="status-image" src="{{bodyStatus.image}}" mode="aspectFit"></image>
      <view class="status-level-badge level-{{bodyStatus.level}}">
        {{bodyStatus.levelText}}
      </view>
    </view>
    <view class="status-info">
      <text class="status-title">{{bodyStatus.title}}</text>
      <text class="status-desc">{{bodyStatus.description}}</text>
    </view>
  </view>

  <view class="checkin-section">
    <button class="btn-checkin" bindtap="handleCheckIn" loading="{{loading}}">
      <text class="btn-text" wx:if="{{!loading}}">ä»Šæ—¥æ¸…é†’æ‰“å¡</text>
      <text class="spinner" wx:else></text>
    </button>
  </view>

  <view class="secondary-section">
    <button class="btn-record" bindtap="handleRecordDrink">ä»Šå¤©æ²¡åšæŒä½ï¼Ÿè®°å½•ä¸€ä¸‹</button>
  </view>

  <navigator url="/pages/sos/sos" class="sos-button">SOS</navigator>

  <view class="bottom-nav">
    <navigator class="nav-item active" url="/pages/index/index" hover-class="">
      <text class="nav-icon">ğŸ </text>
      <text class="nav-label">é¦–é¡µ</text>
    </navigator>
    <navigator class="nav-item" url="/pages/coach/coach" hover-class="">
      <text class="nav-icon">ğŸ’¬</text>
      <text class="nav-label">æ•™ç»ƒ</text>
    </navigator>
    <navigator class="nav-item" url="/pages/community/community" hover-class="">
      <text class="nav-icon">ğŸ‘¥</text>
      <text class="nav-label">ç¤¾åŒº</text>
    </navigator>
    <navigator class="nav-item" url="/pages/profile/profile" hover-class="">
      <text class="nav-icon">ğŸ‘¤</text>
      <text class="nav-label">æˆ‘çš„</text>
    </navigator>
  </view>
</view>

<view class="overlay {{showAchievement ? 'show' : ''}}" wx:if="{{showAchievement}}" bindtap="hideAchievement">
  <view class="achievement-popup {{showAchievement ? 'show' : ''}}" catchtap="hideAchievement">
    <text class="achievement-icon">ğŸ†</text>
    <text class="achievement-title">è§£é”æ–°æˆå°±ï¼</text>
    <text class="achievement-desc">{{achievementDesc}}</text>
  </view>
</view>

<!-- é¥®é…’è®°å½•å¼¹çª— -->
<view class="overlay {{showDrinkModal ? 'show' : ''}}" wx:if="{{showDrinkModal}}" bindtap="closeDrinkModal">
  <view class="drink-modal {{showDrinkModal ? 'show' : ''}}" catchtap="">
    <view class="modal-header">
      <text class="modal-title">è®°å½•é¥®é…’ä¿¡æ¯</text>
      <text class="modal-close" bindtap="closeDrinkModal">Ã—</text>
    </view>

    <view class="modal-body">
      <!-- é…’çš„ç±»å‹ -->
      <view class="form-group">
        <text class="form-label required">é…’çš„ç±»å‹ *</text>
        <picker
          mode="selector"
          range="{{alcoholTypes}}"
          value="{{alcoholTypeIndex}}"
          bindchange="onAlcoholTypeChange"
        >
          <view class="form-picker {{errors.type ? 'error' : ''}}">
            <text class="picker-text">{{drinkForm.typeName || 'è¯·é€‰æ‹©é…’çš„ç±»åˆ«'}}</text>
            <text class="picker-arrow">â€º</text>
          </view>
        </picker>
        <text class="form-error" wx:if="{{errors.type}}">{{errors.type}}</text>
      </view>

      <!-- é…’çš„åå­— -->
      <view class="form-group">
        <text class="form-label">é…’çš„åå­—</text>
        <input
          class="form-input {{errors.name ? 'error' : ''}}"
          placeholder="å¦‚ï¼šé’å²›å•¤é…’ã€èŒ…å°ç­‰"
          value="{{drinkForm.name}}"
          bindinput="onDrinkNameInput"
          maxlength="20"
        />
        <text class="form-error" wx:if="{{errors.name}}">{{errors.name}}</text>
      </view>

      <!-- é…’çš„é‡ -->
      <view class="form-group">
        <text class="form-label required">é…’çš„é‡ *</text>
        <view class="amount-input-wrapper">
          <input
            class="form-input {{errors.amount ? 'error' : ''}}"
            type="digit"
            placeholder="è¯·è¾“å…¥æ•°é‡"
            value="{{drinkForm.amount}}"
            bindinput="onDrinkAmountInput"
          />
          <text class="amount-unit">{{drinkForm.unit || 'ml'}}</text>
        </view>
        <text class="form-hint">åˆç†èŒƒå›´: {{amountRange}}</text>
        <text class="form-error" wx:if="{{errors.amount}}">{{errors.amount}}</text>
      </view>

      <!-- é¥®é…’æ—¶é—´ -->
      <view class="form-group">
        <text class="form-label">é¥®é…’æ—¶é—´</text>
        <picker
          mode="time"
          value="{{drinkForm.time}}"
          bindchange="onDrinkTimeChange"
        >
          <view class="form-picker">
            <text class="picker-text">{{drinkForm.time || 'é€‰æ‹©æ—¶é—´'}}</text>
            <text class="picker-arrow">â€º</text>
          </view>
        </picker>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="form-group">
        <text class="form-label">å¤‡æ³¨</text>
        <textarea
          class="form-textarea"
          placeholder="å¦‚ï¼šèšä¼šã€åº”é…¬ã€æƒ…ç»ªçŠ¶æ€ç­‰"
          value="{{drinkForm.remark}}"
          bindinput="onDrinkRemarkInput"
          maxlength="100"
        />
        <text class="form-char-count">{{drinkForm.remark.length}}/100</text>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn-modal-cancel" bindtap="closeDrinkModal">å–æ¶ˆ</button>
      <button class="btn-modal-confirm" bindtap="submitDrinkRecord">ç¡®è®¤è®°å½•</button>
    </view>
  </view>
</view>
